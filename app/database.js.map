{"version":3,"sources":["../appES6/databaseES5.js"],"names":[],"mappings":"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","file":"database.js","sourcesContent":["define(() => {\r\n\r\n  const getDaySerialCode = () => {\r\n    const now = new Date()\r\n    const time = now.getTime()\r\n    const days = time /86400000\r\n    return Math.floor(days)\r\n  }\r\n\r\n  const createError = (message, error) => {\r\n    let str = message\r\n    if(error) str += (\" | error: \" + error)\r\n    const errorbox = document.querySelector(\".errorbox\")\r\n    errorbox.innerHTML = str \r\n  }\r\n\r\n  const $fb = firebase.firestore().collection(\"leifur\")\r\n\r\n\r\n  const get = key => {\r\n    return JSON.parse(window.localStorage.getItem(key))\r\n  }\r\n\r\n\r\n  const set = (key, data) => {\r\n    window.localStorage.setItem(key, JSON.stringify(data))\r\n  }\r\n\r\n\r\n  const getAvailabilityForDate = (name, date) => {\r\n    const availability = get(\"availability\")\r\n    try {\r\n      return availability[name][date]\r\n    } catch(error) {\r\n      createError(\"Something went wrong here bro... \", error)\r\n    }\r\n  }\r\n\r\n  const uploadRoomTypes = container => {\r\n    console.log(\"Totally updating bro, jk\")\r\n  }\r\n\r\n\r\n  const getRoomTypes = () => {\r\n    const settings = get(\"settings\")\r\n    const roomTypeList = settings.roomTypes\r\n    let array = []\r\n    for(let key in roomTypeList) {\r\n      array.push(key)\r\n    }\r\n\r\n    return array\r\n  }\r\n\r\n  const storeAvailability = (availability) => {\r\n\r\n    const roomTypes = getRoomTypes()\r\n    const storage = {}\r\n    storage[\"total\"] = {}\r\n    roomTypes.forEach(type => {\r\n      storage[type] = {}\r\n    })\r\n\r\n    for(let type in availability) {\r\n      for(let day in availability[type]) {\r\n        storage[type][day] = availability[type][day][0]\r\n        if(storage[\"total\"][day] == undefined) storage[\"total\"][day] = 0\r\n        storage[\"total\"][day] += availability[type][day][0]\r\n      }\r\n    }\r\n    const storageJSON = storage\r\n    set(\"availability\", storageJSON)\r\n    const ref = firebase.firestore().doc(\"leifur/availability\")\r\n    ref.set(storage)\r\n  }\r\n\r\n  const addSerialToList = documentName => {\r\n    const serial = getDaySerialCode()\r\n    const list   = $fb.doc(\"settings\").get()\r\n    list.then(doc => {\r\n      const data = doc.data()\r\n      let newArray = data[\"serialcodes\"]\r\n      let check = true;\r\n      newArray.forEach(item => {\r\n        if(item == serial) check = false\r\n      })\r\n      if(check) newArray.push(serial)\r\n      $fb.doc(\"settings\").set(data)\r\n    })\r\n  }\r\n\r\n  const uploadSettings = data => {\r\n\r\n    //data = get(\"settings\")\r\n    const daySerial = getDaySerialCode()\r\n    const ref = $fb.doc(\"settings/\" + daySerial + \"/settings\")\r\n    ref.set(data)\r\n    addSerialToList(\"settings\")\r\n  }\r\n\r\n\r\n  const loadSettings = callback => {\r\n    \r\n    const a = $fb.doc(\"settings\")\r\n    const settings = $fb.doc(\"settings\").get()\r\n    settings.then(doc0 => {\r\n      const list = doc0.data().serialcodes\r\n      console.log(doc0.data())\r\n      const id   = Math.max(...list)\r\n      $fb.doc(\"settings/\" + id + \"/settings\").get().then(doc1 => {\r\n        console.log(doc1.data())\r\n        set(\"settings\", doc1.data())\r\n        callback()\r\n      })\r\n    })\r\n  }\r\n\r\n\r\n  return {\r\n    loadSettings: loadSettings,\r\n    get: get,\r\n    set: set,\r\n    getAvailabilityForDate: getAvailabilityForDate,\r\n    getDaySerialCode: getDaySerialCode,\r\n    uploadSettings: uploadSettings,\r\n    storeAvailability: storeAvailability,\r\n    createError: createError,\r\n\r\n  }\r\n})"]}