{"version":3,"sources":["../appES6/databaseES5.js"],"names":[],"mappings":";;AAAA,OAAO,mBAAW;;AAEhB,MAAM,mBAAmB,SAAnB,gBAAmB,GAAM;AAC7B,QAAM,MAAM,IAAI,IAAJ,EAAZ;AACA,QAAM,OAAO,IAAI,OAAJ,EAAb;AACA,QAAM,OAAO,OAAM,QAAnB;AACA,WAAO,KAAK,KAAL,CAAW,IAAX,CAAP;AACD,GALD;;AAOA,MAAM,MAAM,SAAS,SAAT,GAAqB,UAArB,CAAgC,QAAhC,CAAZ;;AAEA,MAAM,0BAA0B,SAA1B,uBAA0B,GAAM;AACpC,QAAM,OAAO,QAAQ,SAAR,CAAb;AACA,SAAK,OAAL,CAAa,mBAAb,EAAkC,MAAlC,EAA0C,IAA1C,CAA+C,gBAAQ;AACrD,UAAI,GAAJ,CAAQ,UAAR,EAAoB,GAApB,CAAwB,IAAxB;AACD,KAFD;AAGD,GALD;;AAQA,MAAM,MAAM,SAAN,GAAM,MAAO;AACjB,WAAO,KAAK,KAAL,CAAW,OAAO,YAAP,CAAoB,OAApB,CAA4B,GAA5B,CAAX,CAAP;AACD,GAFD;;AAKA,MAAM,MAAM,SAAN,GAAM,CAAC,GAAD,EAAM,IAAN,EAAe;AACzB,WAAO,YAAP,CAAoB,OAApB,CAA4B,GAA5B,EAAiC,KAAK,SAAL,CAAe,IAAf,CAAjC;AACD,GAFD;;AAKA,MAAM,yBAAyB,SAAzB,sBAAyB,CAAC,IAAD,EAAO,IAAP,EAAgB;AAC7C,QAAM,eAAe,IAAI,cAAJ,CAArB;AACA,QAAI;AACF,aAAO,aAAa,IAAb,EAAmB,IAAnB,CAAP;AACD,KAFD,CAEE,OAAM,KAAN,EAAa;AACb,cAAQ,QAAR,EAAkB,SAAlB,CAA4B,wDAA5B,EAAsF,KAAtF;AACD;AACF,GAPD;;AAUA,MAAM,oBAAoB,SAApB,iBAAoB,CAAC,YAAD,EAAkB;;AAE1C,QAAM,YAAY,QAAQ,aAAR,EAAuB,YAAvB,EAAlB;AACA,QAAM,UAAU,EAAhB;AACA,YAAQ,OAAR,IAAmB,EAAnB;AACA,cAAU,OAAV,CAAkB,gBAAQ;AACxB,cAAQ,IAAR,IAAgB,EAAhB;AACD,KAFD;;AAIA,SAAI,IAAI,IAAR,IAAgB,YAAhB,EAA8B;AAC5B,WAAI,IAAI,GAAR,IAAe,aAAa,IAAb,CAAf,EAAmC;AACjC,gBAAQ,IAAR,EAAc,GAAd,IAAqB,aAAa,IAAb,EAAmB,GAAnB,EAAwB,CAAxB,CAArB;AACA,YAAG,QAAQ,OAAR,EAAiB,GAAjB,KAAyB,SAA5B,EAAuC,QAAQ,OAAR,EAAiB,GAAjB,IAAwB,CAAxB;AACvC,gBAAQ,OAAR,EAAiB,GAAjB,KAAyB,aAAa,IAAb,EAAmB,GAAnB,EAAwB,CAAxB,CAAzB;AACD;AACF;AACD,QAAM,cAAc,KAAK,SAAL,CAAe,OAAf,CAApB;AACA,QAAM,aAAa,kBAAnB;AACA,WAAO,YAAP,CAAoB,OAApB,CAA4B,cAA5B,EAA4C,WAA5C;AACA,QAAM,MAAM,SAAS,SAAT,GAAqB,GAArB,CAAyB,wBAAwB,UAAjD,CAAZ;AACA,QAAI,GAAJ,CAAQ,OAAR;AACD,GArBD;;AAwBA,MAAM,eAAe,SAAf,YAAe,WAAY;AAC/B,QAAM,WAAW,IAAI,GAAJ,CAAQ,UAAR,EAAoB,GAApB,EAAjB;AACA,aAAS,IAAT,CAAc,eAAO;AACnB,UAAI,UAAJ,EAAgB,IAAI,IAAJ,EAAhB;AACA;AACD,KAHD;AAID,GAND;;AASA,SAAO;AACL,kBAAc,YADT;AAEL,SAAK,GAFA;AAGL,SAAK,GAHA;AAIL,uBAAmB,iBAJd;AAKL,4BAAwB,sBALnB;AAML,6BAAyB;;AANpB,GAAP;AASD,CAjFD","file":"database.js","sourcesContent":["define(require => {\r\n\r\n  const getDaySerialCode = () => {\r\n    const now = new Date()\r\n    const time = now.getTime()\r\n    const days = time /86400000\r\n    return Math.floor(days)\r\n  }\r\n\r\n  const $fb = firebase.firestore().collection(\"leifur\")\r\n\r\n  const updateSettingsFromLocal = () => {\r\n    const $req = require(\"request\")\r\n    $req.fromURL(\"rateSettings.json\", \"JSON\").then(data => {\r\n      $fb.doc(\"settings\").set(data)\r\n    })    \r\n  }\r\n\r\n\r\n  const get = key => {\r\n    return JSON.parse(window.localStorage.getItem(key))\r\n  }\r\n\r\n\r\n  const set = (key, data) => {\r\n    window.localStorage.setItem(key, JSON.stringify(data))\r\n  }\r\n\r\n\r\n  const getAvailabilityForDate = (name, date) => {\r\n    const availability = get(\"availability\")\r\n    try {\r\n      return availability[name][date]\r\n    } catch(error) {\r\n      require(\"render\").makeError(\"You probably put in the wrong date when you asked for \", error)\r\n    }\r\n  }\r\n\r\n\r\n  const storeAvailability = (availability) => {\r\n\r\n    const roomTypes = require(\"dataManager\").getRoomTypes()\r\n    const storage = {}\r\n    storage[\"total\"] = {}\r\n    roomTypes.forEach(type => {\r\n      storage[type] = {}\r\n    })\r\n\r\n    for(let type in availability) {\r\n      for(let day in availability[type]) {\r\n        storage[type][day] = availability[type][day][0]\r\n        if(storage[\"total\"][day] == undefined) storage[\"total\"][day] = 0\r\n        storage[\"total\"][day] += availability[type][day][0]\r\n      }\r\n    }\r\n    const storageJSON = JSON.stringify(storage)\r\n    const serialCode = getDaySerialCode()\r\n    window.localStorage.setItem(\"availability\", storageJSON)\r\n    const ref = firebase.firestore().doc(\"leifur/availability\" + serialCode)\r\n    ref.set(storage)\r\n  }\r\n\r\n\r\n  const loadSettings = callback => {\r\n    const settings = $fb.doc(\"settings\").get()\r\n    settings.then(doc => {\r\n      set(\"settings\", doc.data())\r\n      callback()\r\n    })\r\n  }\r\n\r\n\r\n  return {\r\n    loadSettings: loadSettings,\r\n    get: get,\r\n    set: set,\r\n    storeAvailability: storeAvailability,\r\n    getAvailabilityForDate: getAvailabilityForDate,\r\n    updateSettingsFromLocal: updateSettingsFromLocal\r\n\r\n  }\r\n})"]}